<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot du Millionnaire - Polymarket Copy Trading</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2.2">
</head>

<body>
    <!-- MODAL CONFIG WALLET -->
    <div id="wallet-config-modal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close" onclick="closeWalletConfigModal()">&times;</button>
            <h3>‚öôÔ∏è Configuration du Wallet</h3>
            <p style="color: #888; margin-bottom: 20px;" id="modal-wallet-name">Wallet</p>
            <input type="hidden" id="modal-wallet-address">
            <div class="form-group">
                <label>üí∞ Capital Allou√© ($)</label>
                <input type="number" id="modal-capital" value="0" min="0" step="1" placeholder="Ex: 1000">
                <p style="color: #666; font-size: 11px; margin-top: 5px;">Montant total d√©di√© √† ce trader</p>
            </div>
            <div class="form-group">
                <label>üìä % par Trade</label>
                <input type="number" id="modal-percent" value="0" min="0" max="100" step="1" placeholder="Ex: 10">
                <p style="color: #666; font-size: 11px; margin-top: 5px;">Pourcentage du capital utilis√© pour chaque
                    trade</p>
            </div>

            <!-- ‚ú® NOUVEAUX CHAMPS SL/TP -->
            <div class="form-group">
                <label>üõë Stop Loss (%)</label>
                <input type="number" id="modal-sl" value="" min="-100" max="0" step="0.1" placeholder="Ex: -10">
                <p style="color: #666; font-size: 11px; margin-top: 5px;">Perte maximale accept√©e (ex: -10 pour -10%)
                </p>
            </div>

            <div class="form-group">
                <label>üéØ Take Profit (%)</label>
                <input type="number" id="modal-tp" value="" min="0" step="0.1" placeholder="Ex: 20">
                <p style="color: #666; font-size: 11px; margin-top: 5px;">Profit cible (ex: 20 pour +20%)</p>
            </div>

            <!-- ‚ú® TOGGLES GRID -->
            <div class="settings-grid">
                <!-- ‚ú® TRAILING STOP -->
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 0;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="modal-use-trailing">
                        <span class="toggle-slider"></span>
                    </label>
                    <div>
                        <label for="modal-use-trailing" style="cursor: pointer; font-weight: bold; font-size: 12px;">üõ°Ô∏è
                            Trailing Stop</label>
                    </div>
                </div>

                <!-- ‚ú® KELLY CRITERION -->
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 0;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="modal-use-kelly">
                        <span class="toggle-slider"></span>
                    </label>
                    <div>
                        <label for="modal-use-kelly" style="cursor: pointer; font-weight: bold; font-size: 12px;">üß†
                            Kelly Algo</label>
                    </div>
                </div>

                <!-- ‚ú® MODE RISK-FREE -->
                <div class="form-group"
                    style="display: flex; align-items: center; gap: 10px; margin-bottom: 0; grid-column: span 2;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="modal-use-risk-free">
                        <span class="toggle-slider"></span>
                    </label>
                    <div>
                        <label for="modal-use-risk-free" style="cursor: pointer; font-weight: bold; font-size: 12px;">üí∞
                            Risk-Free (Capital Recovery)</label>
                    </div>
                </div>
            </div>

            <!-- ‚ú® PALIERS DE SORTIE -->
            <div class="form-group">
                <label>üéØ Paliers de Take Profit (Optionnel)</label>
                <input type="text" id="modal-tp-tiers" placeholder="ex: 10:20, 20:30, 50:50">
                <p style="color: #666; font-size: 10px; margin-top: 3px;">Format : profit%:sell%</p>
            </div>

            <div style="margin-top: 25px;">
                <button class="btn btn-primary" onclick="saveWalletConfig()" style="width: 100%;">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- MODAL VENTE POSITION -->
    <div id="sell-modal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close" onclick="closeSellModal()">&times;</button>
            <h3>üí∞ Vendre Position</h3>
            <input type="hidden" id="sell-position-id">
            <div class="position-info-modal">
                <p>March√©: <span class="value" id="sell-market-name">-</span></p>
                <p>Position: <span class="value" id="sell-position-side">-</span></p>
                <p>Montant: <span class="value" id="sell-position-amount">$0.00</span></p>
                <p>PnL: <span class="value" id="sell-position-pnl">$0.00</span></p>
            </div>
            <p style="color: #888; margin-bottom: 10px;">Choisissez le pourcentage √† vendre:</p>
            <div class="sell-percent-btns">
                <button class="sell-percent-btn" onclick="selectSellPercent(25)">25%</button>
                <button class="sell-percent-btn" onclick="selectSellPercent(50)">50%</button>
                <button class="sell-percent-btn" onclick="selectSellPercent(75)">75%</button>
                <button class="sell-percent-btn" onclick="selectSellPercent(100)">100%</button>
            </div>
            <input type="hidden" id="sell-percent-value" value="100">
            <div style="margin-top: 20px;">
                <button class="btn btn-danger" onclick="executeSell()" style="width: 100%;">üîª Confirmer la
                    Vente</button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <div class="header">
        <h1>üéØ Bot du Millionnaire</h1>
        <div class="header-status">
            <span id="bot-status" class="status-badge status-off">BOT D√âSACTIV√â</span>
            <button id="toggle-bot-btn" class="btn btn-primary" onclick="toggleBot()">Activer le Bot</button>
        </div>
    </div>

    <!-- NAVIGATION -->
    <div class="nav-tabs">
        <div class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</div>
        <div class="nav-tab" onclick="showTab('live')">üìã Flux Trades</div>
        <div class="nav-tab" onclick="showTab('wallets')">üëõ Wallets Suivis</div>
        <div class="nav-tab" onclick="showTab('history')">üìú Historique</div>
        <div class="nav-tab" onclick="showTab('insider')">üîç Insider Tracker</div>
        <div class="nav-tab" onclick="showTab('saved')">üìÅ Saved Wallets</div>
        <div class="nav-tab" onclick="showTab('settings')">‚öôÔ∏è Param√®tres</div>
    </div>

    <div class="container">
        <!-- ============ DASHBOARD ============ -->
        <div id="tab-dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>üì° Signaux D√©tect√©s</h3>
                    <div class="value" id="signals-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>üìà Trades Copi√©s</h3>
                    <div class="value" id="trades-copied">0</div>
                </div>
                <div class="stat-card">
                    <h3>üí∞ Profit Total</h3>
                    <div class="value" id="total-profit">$0.00</div>
                </div>
                <div class="stat-card">
                    <h3>üéØ Win Rate</h3>
                    <div class="value" id="win-rate">0%</div>
                </div>
            </div>

            <!-- ‚ú® Graphique PnL -->
            <div style="margin-top: 20px; height: 300px;">
                <canvas id="pnlChart"></canvas>
            </div>

            <!-- SOLDES WALLETS -->
            <div class="two-columns">
                <div class="card">
                    <h2>üëõ Wallet Polymarket (Polygon)</h2>
                    <div id="pm-wallet-info">
                        <p style="color: #888; font-size: 12px; margin-bottom: 10px;" id="pm-wallet-addr">Non
                            configur√©
                        </p>
                        <div class="flex flex-between flex-center">
                            <span>Balance USDC</span>
                            <span class="value" id="pm-balance-usdc" style="font-size: 20px;">$0.00</span>
                        </div>
                        <div class="flex flex-between flex-center" style="margin-top: 8px;">
                            <span>Balance MATIC</span>
                            <span id="pm-balance-matic" style="color: #00B0FF;">0.00 MATIC</span>
                        </div>
                    </div>
                </div>


            </div>

            <div class="two-columns">
                <div class="card">
                    <h2>üìä Polymarket Copy Trading</h2>
                    <div class="flex flex-between flex-center" style="margin-bottom: 15px;">
                        <span>Status</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="polymarket-toggle" onchange="togglePolymarket()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                </div>


            </div>

            <div class="card">
                <h2>üìà Positions Actives</h2>
                <div id="active-positions">
                    <p style="color: #888; text-align: center; padding: 20px;">Aucune position active</p>
                </div>
            </div>
        </div>

        <!-- ============ LIVE TRADING ============ -->
        <div id="tab-live" class="tab-content">
            <div class="card">
                <h2>üìã Flux des Trades (Wallets Suivis)</h2>
                <div id="live-feed" style="max-height: 500px; overflow-y: auto;">
                    <p style="color: #888; text-align: center; padding: 20px;">
                        En attente de signaux...
                    </p>
                </div>
            </div>

            <div class="card">
                <h2>üìä Derniers Trades Copi√©s</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>March√©</th>
                            <th>Position</th>
                            <th>Montant</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recent-trades">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #888;">Aucun trade r√©cent</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============ WALLETS SUIVIS ============ -->
        <div id="tab-wallets" class="tab-content">
            <div class="card">
                <h2>üëõ Ajouter un Wallet √† Suivre</h2>
                <div class="form-group">
                    <label>Adresse du Wallet Polymarket</label>
                    <input type="text" id="new-wallet-address" placeholder="0x...">
                </div>
                <div class="form-group">
                    <label>Nom (optionnel)</label>
                    <input type="text" id="new-wallet-name" placeholder="Whale #1">
                </div>
                <button class="btn btn-primary" onclick="addWallet()">+ Ajouter Wallet</button>
            </div>

            <div class="card">
                <h2>üìã Wallets Suivis</h2>
                <div id="wallets-list" class="wallet-list">
                    <p style="color: #888; text-align: center; padding: 20px;">Aucun wallet suivi</p>
                </div>
            </div>

            <div class="card">
                <h2>üèÜ Benchmark des Wallets</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Rang</th>
                            <th>Wallet</th>
                            <th>Win Rate</th>
                            <th>PnL</th>
                            <th>Trades</th>
                        </tr>
                    </thead>
                    <tbody id="benchmark-table">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #888;">Pas de donn√©es</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============ HISTORIQUE ============ -->
        <div id="tab-history" class="tab-content">
            <div class="card">
                <h2>üìú Historique des Trades</h2>
                <div class="flex gap-10" style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="filterHistory('all')">Tous</button>
                    <button class="btn btn-secondary" onclick="filterHistory('won')">Gagn√©s</button>
                    <button class="btn btn-secondary" onclick="filterHistory('lost')">Perdus</button>
                    <button class="btn btn-secondary" onclick="filterHistory('pending')">En cours</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>March√©</th>
                            <th>Position</th>
                            <th>Prix Entr√©e</th>
                            <th>Prix Sortie</th>
                            <th>PnL</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="history-table">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #888;">Aucun historique</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>



        <!-- ============ INSIDER TRACKER ============ -->
        <div id="tab-insider" class="tab-content">
            <div class="two-columns">
                <!-- CONFIG SCANNER -->
                <div class="card">
                    <h2>üîç Scanner Configuration</h2>
                    <div class="flex flex-between flex-center" style="margin-bottom: 15px;">
                        <span>Scanner Status</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="insider-scanner-toggle" onchange="toggleInsiderScanner()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Preset de Scoring</label>
                        <select id="insider-preset" onchange="onInsiderPresetChange()">
                            <option value="balanced">Balanced (35/35/30)</option>
                            <option value="profile_priority">Profile Priority (25/25/50)</option>
                            <option value="behavior_priority">Behavior Priority (25/50/25)</option>
                            <option value="bet_priority">Bet Priority (50/25/25)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Seuil d'Alerte (0-100)</label>
                        <input type="number" id="insider-threshold" value="60" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>Categories a Scanner</label>
                        <div class="category-toggles" id="category-toggles">
                            <span class="category-toggle active" data-category="politics" onclick="toggleCategory(this)">politics</span>
                            <span class="category-toggle active" data-category="sports" onclick="toggleCategory(this)">sports</span>
                            <span class="category-toggle active" data-category="crypto" onclick="toggleCategory(this)">crypto</span>
                            <span class="category-toggle active" data-category="pop-culture" onclick="toggleCategory(this)">pop-culture</span>
                        </div>
                    </div>

                    <!-- ADVANCED SETTINGS (collapsible) -->
                    <details style="margin-top: 15px;">
                        <summary style="cursor: pointer; color: #00B0FF; font-size: 13px;">‚öôÔ∏è Advanced Settings</summary>
                        <div style="margin-top: 15px;">
                            <h4 style="color: #888; font-size: 12px; margin-bottom: 10px;">Seuils de Detection</h4>
                            <div class="settings-grid" style="grid-template-columns: 1fr 1fr;">
                                <div class="form-group">
                                    <label style="font-size: 11px;">Min Bet Amount ($)</label>
                                    <input type="number" id="insider-min-bet" value="1000" min="0">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 11px;">Max Odds Threshold (%)</label>
                                    <input type="number" id="insider-max-odds" value="10" min="1" max="50">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 11px;">Dormant Days</label>
                                    <input type="number" id="insider-dormant-days" value="30" min="1">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 11px;">Dormant Min Bet ($)</label>
                                    <input type="number" id="insider-dormant-bet" value="500" min="0">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 11px;">New Wallet Max TX</label>
                                    <input type="number" id="insider-max-tx" value="15" min="1">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 11px;">New Wallet Min Bet ($)</label>
                                    <input type="number" id="insider-new-bet" value="500" min="0">
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- CUSTOM WEIGHTS (visible si preset = custom) -->
                    <div id="custom-weights-section" style="display: none; margin-top: 15px;">
                        <h4 style="color: #888; font-size: 12px; margin-bottom: 10px;">Poids Custom</h4>
                        <div class="form-group">
                            <label style="font-size: 11px;">Unlikely Bet: <span id="weight-unlikely-val">35</span>%</label>
                            <input type="range" id="weight-unlikely" value="35" min="0" max="100" oninput="updateWeightDisplay()">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 11px;">Abnormal Behavior: <span id="weight-abnormal-val">35</span>%</label>
                            <input type="range" id="weight-abnormal" value="35" min="0" max="100" oninput="updateWeightDisplay()">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 11px;">Suspicious Profile: <span id="weight-profile-val">30</span>%</label>
                            <input type="range" id="weight-profile" value="30" min="0" max="100" oninput="updateWeightDisplay()">
                        </div>
                        <p style="color: #666; font-size: 10px;">Total: <span id="weights-total">100</span>% (sera normalise)</p>
                    </div>

                    <button class="btn btn-primary" onclick="saveInsiderConfig()" style="width: 100%; margin-top: 15px;">Sauvegarder Config</button>
                </div>

                <!-- STATS SCANNER -->
                <div class="card">
                    <h2>üìä Scanner Stats</h2>
                    <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="stat-card">
                            <h3>Alertes Generees</h3>
                            <div class="value" id="insider-alerts-count">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Marches Scannes</h3>
                            <div class="value" id="insider-markets-count">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Dernier Scan</h3>
                            <div class="value" id="insider-last-scan" style="font-size: 12px;">Never</div>
                        </div>
                        <div class="stat-card">
                            <h3>Status</h3>
                            <div class="value" id="insider-status" style="font-size: 14px;">Stopped</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="triggerManualScan()" style="width: 100%; margin-top: 15px;">üîç Scan Manuel</button>
                </div>
            </div>

            <!-- ALERT FEED -->
            <div class="card">
                <h2>üö® Real-Time Alert Feed</h2>
                <div id="insider-alert-feed" class="alert-feed">
                    <p style="color: #888; text-align: center; padding: 40px;">
                        En attente d'alertes... Activez le scanner pour commencer.
                    </p>
                </div>
            </div>
        </div>

        <!-- ============ SAVED WALLETS ============ -->
        <div id="tab-saved" class="tab-content">
            <div class="card">
                <h2>üìÅ Wallets Sauvegardes pour Analyse</h2>
                <p style="color: #888; font-size: 12px; margin-bottom: 20px;">
                    Wallets detectes comme suspects et sauvegardes pour suivi ulterieur.
                </p>
                <div id="saved-wallets-list">
                    <p style="color: #888; text-align: center; padding: 20px;">
                        Aucun wallet sauvegarde. Utilisez le bouton "Save" sur une alerte pour ajouter.
                    </p>
                </div>
            </div>
        </div>

        <!-- ============ PARAM√àTRES ============ -->
        <div id="tab-settings" class="tab-content">
            <div class="two-columns">
                <!-- WALLET & API POLYMARKET -->
                <div class="card">
                    <h2>üîë Identifiants Polymarket</h2>
                    <div class="form-group">
                        <label>Adresse du Wallet (Proxy/Metamask)</label>
                        <input type="text" id="pm-wallet-address" placeholder="0x...">
                    </div>
                    <div class="form-group">
                        <label>Cl√© Priv√©e du Wallet</label>
                        <input type="password" id="pm-wallet-key" placeholder="Cl√© priv√©e (sera chiffr√©e)">
                    </div>
                    <hr style="border-color: rgba(255,255,255,0.05); margin: 20px 0;">
                    <div class="form-group">
                        <label>API Key Polymarket</label>
                        <input type="text" id="pm-api-key" placeholder="API Key">
                    </div>
                    <div class="form-group">
                        <label>API Secret</label>
                        <input type="password" id="pm-api-secret" placeholder="API Secret">
                    </div>
                    <div class="form-group">
                        <label>API Passphrase</label>
                        <input type="password" id="pm-api-passphrase" placeholder="Passphrase">
                    </div>
                    <div class="form-group">
                        <label>Polygonscan API Key (Optionnel)</label>
                        <input type="text" id="polygonscan-api-key" placeholder="Pour l'historique complet">
                    </div>
                    <button class="btn btn-primary" onclick="savePolymarketCredentials()"
                        style="width: 100%;">Sauvegarder les Identifiants</button>
                    <p style="color: #888; font-size: 11px; margin-top: 10px;">
                        ‚ö†Ô∏è Vos cl√©s sont chiffr√©es au repos via SecretManager.
                    </p>
                </div>


            </div>

            <div class="two-columns">
                <!-- CONFIG POLYMARKET -->
                <div class="card">
                    <h2>üìä Configuration Polymarket</h2>
                    <div class="form-group">
                        <label>Intervalle de Polling (secondes)</label>
                        <input type="number" id="pm-polling" value="30" min="10">
                    </div>
                    <div class="form-group">
                        <label>Position Maximum ($)</label>
                        <input type="number" id="pm-max-position" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Position Minimum ($)</label>
                        <input type="number" id="pm-min-position" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Pourcentage √† copier (%)</label>
                        <input type="number" id="pm-copy-percent" value="100" min="1" max="100">
                    </div>
                    <button class="btn btn-primary" onclick="savePolymarketConfig()">Sauvegarder Config</button>
                </div>


            </div>

            <div class="card">
                <h2>üîß Actions</h2>
                <div class="flex gap-10">
                    <button class="btn btn-secondary" onclick="exportData()">üì§ Exporter Donn√©es</button>
                    <button class="btn btn-danger" onclick="resetStats()">üóëÔ∏è Reset Statistiques</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN JS -->
    <!-- Socket.IO & Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}?v=2.3"></script>
    <script src="{{ url_for('static', filename='js/insider.js') }}?v=1.0"></script>
</body>

</html>